<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì£¼ë¬¸ API í…ŒìŠ¤íŠ¸</title>
    <style>
        .item-row { margin-bottom: 5px; }
        table {
            border-collapse: collapse;
            margin-top: 10px;
            width: 100%;
        }
        th, td {
            border: 1px solid #aaa;
            padding: 5px 10px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        button {
            margin-top: 5px;
        }
        .error {
            color: red;
            margin-top: 10px;
        }
        .success {
            color: green;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<h1>ğŸ›’ ì£¼ë¬¸ API í…ŒìŠ¤íŠ¸ í™”ë©´</h1>

<!-- ì£¼ë¬¸ ìƒì„± -->
<section style="margin-bottom: 30px;">
    <h2>1. ì£¼ë¬¸ ìƒì„± (ì—¬ëŸ¬ ìƒí’ˆ)</h2>
    <form id="createOrderForm">
        <div id="itemList">
            <div class="item-row">
                ìƒí’ˆ ID: <input type="number" name="itemId" required>
                ìˆ˜ëŸ‰: <input type="number" name="quantity" value="1" required>
                <button type="button" onclick="removeItemRow(this)">âŒ</button>
            </div>
        </div>
        <button type="button" onclick="addItemRow()">â• ìƒí’ˆ ì¶”ê°€</button><br><br>
        <button type="submit">ì£¼ë¬¸ ìƒì„±</button>
    </form>
    <div id="createOrderResult"></div>
</section>

<!-- ì£¼ë¬¸ ìƒí’ˆ ì·¨ì†Œ -->
<section style="margin-bottom: 30px;">
    <h2>2. ì£¼ë¬¸ ìƒí’ˆ ì·¨ì†Œ</h2>
    <form id="cancelOrderForm">
        ì£¼ë¬¸ ID: <input type="number" name="orderId" required>
        ìƒí’ˆ ID: <input type="number" name="itemId" required>
        <button type="submit">ìƒí’ˆ ì·¨ì†Œ</button>
    </form>
    <div id="cancelOrderResult"></div>
</section>

<!-- ì£¼ë¬¸ ì¡°íšŒ -->
<section>
    <h2>3. ì£¼ë¬¸ ì¡°íšŒ</h2>
    <form id="getOrderForm">
        ì£¼ë¬¸ ID: <input type="number" name="orderId" required>
        <button type="submit">ì£¼ë¬¸ ì¡°íšŒ</button>
    </form>
    <div id="getOrderResult"></div>
</section>

<script>
    function addItemRow() {
        const itemList = document.getElementById('itemList');
        const row = document.createElement('div');
        row.className = 'item-row';
        row.innerHTML = `
            ìƒí’ˆ ID: <input type="number" name="itemId" required>
            ìˆ˜ëŸ‰: <input type="number" name="quantity" value="1" required>
            <button type="button" onclick="removeItemRow(this)">âŒ</button>
        `;
        itemList.appendChild(row);
    }

    function removeItemRow(button) {
        button.parentNode.remove();
    }

    function renderTable(data, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = ''; // ì´ˆê¸°í™”

        const table = document.createElement('table');
        const tbody = document.createElement('tbody');

        for (const [key, value] of Object.entries(data)) {
            const row = document.createElement('tr');

            const keyCell = document.createElement('th');
            keyCell.textContent = key;

            const valueCell = document.createElement('td');
            valueCell.textContent = typeof value === 'object' ? JSON.stringify(value, null, 2) : value;

            row.appendChild(keyCell);
            row.appendChild(valueCell);
            tbody.appendChild(row);
        }

        table.appendChild(tbody);
        container.appendChild(table);
        container.className = 'success';
    }

    function renderError(errorData, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';

        const table = document.createElement('table');
        const tbody = document.createElement('tbody');

        for (const [key, value] of Object.entries(errorData)) {
            const row = document.createElement('tr');
            const keyCell = document.createElement('th');
            keyCell.textContent = key;

            const valueCell = document.createElement('td');
            valueCell.textContent = typeof value === 'object' ? JSON.stringify(value, null, 2) : value;

            row.appendChild(keyCell);
            row.appendChild(valueCell);
            tbody.appendChild(row);
        }

        table.appendChild(tbody);
        container.appendChild(table);
        container.className = 'error';
    }

    // fetch wrapper
    async function fetchJson(url, options, containerId) {
        try {
            const res = await fetch(url, options);
            const data = await res.json();

            if (!res.ok) {
                renderError(data, containerId);
            } else {
                renderTable(data, containerId);
            }
        } catch (err) {
            renderError({ error: 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ì„œë²„ê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŒ' }, containerId);
        }
    }

    // ì£¼ë¬¸ ìƒì„±
    document.getElementById('createOrderForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const itemRows = document.querySelectorAll('#itemList .item-row');
        const orderItemList = [];

        itemRows.forEach(row => {
            const itemId = row.querySelector('[name="itemId"]').value;
            const quantity = row.querySelector('[name="quantity"]').value;
            if (itemId && quantity) {
                orderItemList.push({ itemId: parseInt(itemId), quantity: parseInt(quantity) });
            }
        });

        fetchJson('/orders', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ orderItemList })
        }, 'createOrderResult');
    });

    // ì£¼ë¬¸ ìƒí’ˆ ì·¨ì†Œ
    document.getElementById('cancelOrderForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const orderId = parseInt(e.target.orderId.value);
        const itemId = parseInt(e.target.itemId.value);

        fetchJson(`/orders/${orderId}/cancel/${itemId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ orderId, itemId })
        }, 'cancelOrderResult');
    });

    // ì£¼ë¬¸ ì¡°íšŒ
    document.getElementById('getOrderForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const orderId = parseInt(e.target.orderId.value);

        fetchJson(`/orders/${orderId}`, {
            method: 'GET',
            headers: { 'Accept': 'application/json' }
        }, 'getOrderResult');
    });
</script>
</body>
</html>
